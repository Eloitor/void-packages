# Template file for 'eric-ide'
pkgname=eric-ide
version=24.8
revision=1
build_style=python3-pep517
hostmakedepends="python3-setuptools python3-wheel"
depends="python3-pyqt6 python3-pyqt6-charts python3-pyqt6-webengine
 python3-pyqt6-qsci python3-docutils python3-Markdown python3-esprima
 python3-yaml python3-tomlkit python3-chardet python3-asttokens
 python3-editorconfig python3-Pygments python3-parso python3-jedi
 python3-trove-classifiers black python3-isort
 python3-coverage python3-semver python3-watchdog python3-psutil
 python3-fido2 python3-pyqt6-serialport python3-pyqt6-websockets
 python3-pyqt6-sip python3-pyqt6-webchannel python3-pyqt6-tools"
short_desc="Full-featured Python and Ruby IDE in PyQt"
maintainer="Eloi Torrents <eloitor@duck.com>"
license="GPL-3.0-or-later"
homepage="https://eric-ide.python-projects.org/"
changelog="https://eric-ide.python-projects.org/eric-news.html"
distfiles="${PYPI_SITE}/e/eric-ide/eric_ide-${version}.tar.gz"
checksum=a1aaedd4d3a0147571ac400aebc8b94238447b92ae8a3e4786faee8e671897d3

do_patch() {
	find . -name '*.desktop' -exec sed -i "s|@BINDIR@|/usr/bin|g" {} \;
	vsed -e "s|^Icon=.*|Icon=/usr/share/icons/hicolor/scalable/apps/eric.svg|" -i src/eric7/data/linux/eric7_ide.desktop
	vsed -e "s|^Icon=.*|Icon=/usr/share/icons/hicolor/scalable/apps/ericMPy48.svg|" -i src/eric7/data/linux/eric7_mpy.desktop
	vsed -e "s|^Icon=.*|Icon=/usr/share/icons/hicolor/scalable/apps/ericWeb48.svg|" -i src/eric7/data/linux/eric7_browser.desktop
	rm src/eric7/eric7_post_install.py
}

post_install() {
	vinstall src/eric7/data/linux/eric7_browser.desktop 644 /usr/share/applications
	vinstall src/eric7/data/linux/eric7_ide.desktop 644 /usr/share/applications
	vinstall src/eric7/data/linux/eric7_mpy.desktop 644 /usr/share/applications

	for icon in eric48_icon.png ericMPy48_icon.png ericWeb48_icon.png; do
		vinstall "src/eric7/pixmaps/$icon" 644 /usr/share/icons/hicolor/48x48/apps
	done

	for svg_icon in eric.svg ericMPy48.svg ericWeb48.svg; do
		vinstall "src/eric7/pixmaps/$svg_icon" 644 /usr/share/icons/hicolor/scalable/apps/
	done

	vinstall src/eric7/data/linux/eric7.appdata.xml 644 /usr/share/metainfo
}
