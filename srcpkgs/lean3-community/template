# Template file for 'lean3-community'
pkgname=lean3-community
version=3.50.3
revision=1
build_wrksrc=src
build_style=cmake
configure_args="-DUSE_GITHASH=OFF"
hostmakedepends="python3"
makedepends="gmp-devel"
short_desc="Lean Theorem Prover, maintained by the Lean community"
maintainer="Eloi Torrents <eloitor@disroot.org>"
license="Apache-2.0"
homepage="https://leanprover-community.github.io/"
changelog="https://raw.githubusercontent.com/leanprover-community/lean/master/doc/changes.md"
distfiles="https://github.com/leanprover-community/lean/archive/v${version}.tar.gz"
checksum=00316c946de2aa4f1b6655ea8bd92b21ff184afd305891e6803c7631753f5b87
nocross=yes # runs binaries built for target (TODO)

if [ -n "$CROSS_BUILD" ]; then
	configure_args+=" -DCROSS_COMPILE=ON"
fi

do_check() {
	cd ${cmake_builddir:=build}
	# style_check: fails on (generated file)
	#	CMakeFiles/3.22.2/CompilerIdCXX/CMakeCXXCompilerId.cpp
	#   See: https://github.com/void-linux/void-packages/pull/35907
	# complete_trailing_period: fails on i686
	#	See: https://github.com/leanprover-community/lean/issues/685
	ctest -E 'style_check|complete_trailing_period' ${makejobs}
}
