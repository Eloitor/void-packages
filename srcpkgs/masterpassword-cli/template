# Template file for 'masterpassword-cli'
pkgname=masterpassword-cli
version=2.7
revision=1
build_wrksrc=platform-independent/c/cli
build_style=cmake
cmake_builddir=cmake
hostmakedepends="libsodium-devel json-c-devel ncurses-devel"
makedepends="libsodium-devel json-c-devel ncurses-devel"
short_desc="CLI version of Master Password"
maintainer="SolitudeSF <solitudesf@protonmail.com>"
license="GPL-3.0-or-later, Apache-1.0, ISC, BSD-4-Clause"
homepage="https://ssl.masterpasswordapp.com/"
distfiles="https://github.com/Lyndir/MasterPassword/archive/${version}-cli-1.tar.gz"
checksum=192aa64e3d879b20de84543dd0786153d09c2c885b58054ade8d8f60758968bc
# Apache-1.0 is incompatible with GPL-3+
restricted=yes

pre_configure() {
	echo "${version}-cli" > ${wrksrc}/${build_wrksrc}/VERSION
}

do_install() {
	cat mpw.completion.bash | tail -n +3 >> bashcomplib
	vinstall bashcomplib 644 usr/share/bash-completion/completions mpw
	vbin ${cmake_builddir}/mpw

	sed -n '5,31p' src/blf.h >blowfish.4BSD
	vlicense blowfish.4BSD
	sed -n '4,17p' src/bcrypt.c >bcrypt.ISC
	vlicense bcrypt.ISC
	head -55 ../core/src/base64.c >base64.license
	vlicense base64.license
}
