# Template file for 'tclMuPDF'
pkgname=tclMuPDF
version=2.4
revision=1
_ref=1235
hostmakedepends="tcl tcllib"
makedepends="tcl-devel tk-devel"
depends="tcl-publisher"
short_desc="Tcl meets MuPDF"
maintainer="Eloi Torrents <eloitor@disroot.org>"
license="custom"
homepage="https://wiki.tcl-lang.org/page/tclMuPdf"
distfiles="https://sourceforge.net/code-snapshots/svn/i/ir/irrational-numbers/code/irrational-numbers-code-r${_ref}-pkgs-tclMuPdf-devkit-tags-${version}.zip"
checksum=91580432550f3115d10aaa2e657c7dbe6e8eec0bd09941e89d150c1d15e663ba

do_patch() {
	sed -i 's|tclsh BuildSupport/apps.dtplite/dtplite.tcl|dtplite|g' cross-makefile
}

do_build() {
	bash build.sh
}

do_install() {
	vmkdir usr/lib/tclMuPDF/linux-x64

	vinstall XBUILD/tclMuPDF/pkgIndex.tcl 644 usr/lib/tclMuPDF
	vinstall XBUILD/tclMuPDF/class_Doc.tcl 644 usr/lib/tclMuPDF
	vinstall XBUILD/tclMuPDF/class_Page.tcl 644 usr/lib/tclMuPDF
	vinstall XBUILD/tclMuPDF/class_TextSearch.tcl 644 usr/lib/tclMuPDF
	vinstall XBUILD/tclMuPDF/mupdf.tcl 644 usr/lib/tclMuPDF

	for _f in XBUILD/linux-x64/*.obj; do
		vinstall "${_f}" 644 usr/lib/tclMuPDF/linux-x64 
	done
	vinstall XBUILD/linux-x64/MUPage.tkobj 644 usr/lib/tclMuPDF/linux-x64
	vinstall XBUILD/linux-x64/libtclMuPDF.so 644 usr/lib/tclMuPDF/linux-x64
	vinstall XBUILD/linux-x64/libtkMuPDF.so 644 usr/lib/tclMuPDF/linux-x64
}

post_install() {
	vlicense tclMuPDF-license.terms
}
